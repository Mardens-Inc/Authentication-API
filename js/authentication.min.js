export default class Authentication{constructor(debug=false){this.apiUrl=debug?"http://auth.local/":"https://auth.mardens.com/";this.debugMode=debug;try{this.token=document.cookie.split(";").find(row=>row.trim().startsWith("token=")).trim().slice(6)}catch(e){this.token=null}if(!window.$){throw new Error("jQuery is required for this library to work.")}}async login(username,password){return await $.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{username:username,password:password},success:data=>{if(data.success&&data.token){this.generateCookies(data.token)}return data},error:err=>{return err}})}async loginWithToken(token){return await $.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{token:token},success:data=>{if(data.success){this.generateCookies(token)}return data},error:err=>{return err}})}async loginWithTokenFromCookie(){return this.token==null?false:await this.loginWithToken(this.token)}logout(){document.cookie=`token=; path=/; domain=.${window.location.hostname}; samesite=strict; expires=Thu, 01 Jan 1970 00:00:00 GMT`;$(this).trigger("logout")}generateCookies(token){let expire=new Date;expire.setDate(expire.getDate()+2);document.cookie=`token=${token}; path=/; domain=.${window.location.hostname}; samesite=strict; expires=${expire.toGMTString()}`;this.token=token;$(this).trigger("login")}}